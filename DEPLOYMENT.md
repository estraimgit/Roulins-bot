# Инструкции по развертыванию

## Предварительные требования

1. Python 3.9 или выше
2. Telegram Bot Token (получить у @BotFather)
3. База данных SQLite (включена в проект)

## Установка

1. **Клонируйте репозиторий:**
```bash
git clone git@github.com:estraimgit/Roulins-bot.git
cd Roulins-bot
```

2. **Создайте виртуальное окружение:**
```bash
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
```

3. **Установите зависимости:**
```bash
pip install -r requirements.txt
```

4. **Настройте переменные окружения:**
```bash
cp config.env.example .env
```

Отредактируйте файл `.env` и укажите:
- `BOT_TOKEN` - токен вашего бота от @BotFather
- `ENCRYPTION_KEY` - ключ шифрования (32+ символов)
- Другие настройки по необходимости

## Локальное тестирование

1. **Запустите бота в режиме polling:**
```bash
python main.py
```

2. **Найдите вашего бота в Telegram и отправьте команду `/start`**

## Развертывание в продакшене

### Вариант 1: Использование webhook (рекомендуется)

1. **Настройте HTTPS сервер** (например, используя nginx + SSL)

2. **Обновите переменные окружения:**
```bash
WEBHOOK_URL=https://your-domain.com/webhook
WEBHOOK_PORT=8443
```

3. **Запустите бота:**
```bash
python main.py
```

### Вариант 2: Использование ngrok для тестирования

1. **Установите ngrok:**
```bash
# Скачайте с https://ngrok.com/
```

2. **Запустите ngrok:**
```bash
ngrok http 8443
```

3. **Обновите .env файл с URL от ngrok:**
```bash
WEBHOOK_URL=https://your-ngrok-url.ngrok.io/webhook
```

4. **Запустите бота:**
```bash
python main.py
```

## Мониторинг и логи

- Логи сохраняются в файл `logs/bot.log`
- База данных: `data/experiment.db`
- Для просмотра статистики используйте команду `/status` (только для администраторов)

## Безопасность

1. **Никогда не коммитьте файл `.env` в репозиторий**
2. **Используйте сильный ключ шифрования** (32+ символов)
3. **Регулярно создавайте резервные копии базы данных**
4. **Ограничьте доступ к команде `/status` только администраторам**

## Структура данных

### Таблицы базы данных:

- `participants` - информация об участниках
- `chat_messages` - все сообщения чата (зашифрованы)
- `survey_responses` - ответы на опрос

### Экспорт данных:

Для анализа данных используйте SQLite клиент или Python скрипты:

```python
import sqlite3
import pandas as pd

# Подключение к базе данных
conn = sqlite3.connect('data/experiment.db')

# Экспорт участников
participants = pd.read_sql_query("SELECT * FROM participants", conn)

# Экспорт сообщений (требует расшифровки)
messages = pd.read_sql_query("SELECT * FROM chat_messages", conn)

# Экспорт ответов опроса
survey = pd.read_sql_query("SELECT * FROM survey_responses", conn)
```

## Устранение неполадок

### Бот не отвечает:
1. Проверьте токен бота
2. Убедитесь, что бот не заблокирован
3. Проверьте логи на наличие ошибок

### Ошибки базы данных:
1. Убедитесь, что папка `data/` существует
2. Проверьте права доступа к файлам
3. Проверьте логи на наличие ошибок SQLite

### Проблемы с переводами:
1. Проверьте подключение к интернету
2. Убедитесь, что Google Translate API доступен
3. При необходимости отключите переводы в коде

## Масштабирование

Для большого количества участников рассмотрите:

1. **Использование PostgreSQL** вместо SQLite
2. **Горизонтальное масштабирование** с несколькими экземплярами бота
3. **Кэширование** для часто используемых переводов
4. **Мониторинг производительности** с помощью инструментов типа Prometheus

## Поддержка

При возникновении проблем:

1. Проверьте логи в `logs/bot.log`
2. Убедитесь, что все зависимости установлены
3. Проверьте конфигурацию в файле `.env`
4. Создайте issue в репозитории GitHub
